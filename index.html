<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Volt –ò–∑–ø–∏—Ç - –ê–¥—Ä–µ—Å–∏ –°–æ—Ñ–∏—è (ULTIMATE)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            padding-top: 120px; /* More space for double navbar on mobile */
            padding-bottom: 40px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* CARD FLIP ANIMATION */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            border-radius: 15px;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            flex-direction: column;
        }

        .flip-card-front {
            background-color: white;
            color: black;
            border: 2px solid #0d6efd;
        }

        .flip-card-back {
            background-color: #0d6efd;
            color: white;
            transform: rotateY(180deg);
        }

        /* UI ELEMENTS */
        .stat-badge { font-size: 0.85rem; width: 45px; text-align: center; }
        .address-sub { font-size: 0.85rem; color: #6c757d; }
        .view-section { display: none; }
        .view-section.active { display: block; }
        
        .highlight-addr { font-weight: bold; }
        .highlight-name { font-weight: bold; }

        /* Custom Navbar adjustments */
        .nav-link { cursor: pointer; }
        .controls-row {
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            background: #e9ecef;
            z-index: 1020;
            padding: 5px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

<nav class="navbar fixed-top navbar-dark bg-primary shadow-sm">
    <div class="container-fluid justify-content-center">
        <ul class="nav nav-pills" id="mainNav">
            <li class="nav-item">
                <a class="nav-link text-white active" id="tab-quiz" onclick="switchTab('quiz')">üéÆ –¢–µ—Å—Ç</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" id="tab-flash" onclick="switchTab('flash')">üé¥ –ö–∞—Ä—Ç–∏</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" id="tab-list" onclick="switchTab('list')">üìä –°–ø–∏—Å—ä–∫</a>
            </li>
        </ul>
    </div>
</nav>

<div class="controls-row d-flex justify-content-center align-items-center gap-2">
    <span class="small text-muted fw-bold">–†–µ–∂–∏–º:</span>
    <select id="gameMode" class="form-select form-select-sm w-auto border-primary" onchange="refreshCurrentView()">
        <option value="mixed">üîÄ –°–º–µ—Å–µ–Ω (Random)</option>
        <option value="standard">–ò–º–µ ‚û° –ê–¥—Ä–µ—Å</option>
        <option value="reverse">–ê–¥—Ä–µ—Å ‚û° –ò–º–µ</option>
    </select>
</div>

<div class="container main-content">
    
    <div id="view-quiz" class="view-section active">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                
                <div class="d-flex justify-content-between mb-2 px-2 text-muted small fw-bold">
                    <span>üî• –°–µ—Ä–∏—è: <span id="streak" class="text-primary">0</span></span>
                    <span>‚úÖ –í–µ—Ä–Ω–∏: <span id="total-correct" class="text-success">0</span></span>
                </div>

                <div class="card shadow border-0 rounded-4">
                    <div class="card-body p-4 text-center">
                        <p id="q-label" class="text-uppercase text-muted mb-2 small fw-bold">–í—ä–ø—Ä–æ—Å:</p>
                        
                        <h4 class="card-title mb-4 fw-bold" id="question-text" style="min-height: 3.5rem; display:flex; align-items:center; justify-content:center;">
                            –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...
                        </h4>
                        
                        <div id="options-container" class="d-grid gap-2">
                            </div>

                        <div id="feedback-container" class="mt-3" style="min-height: 50px;">
                            <p id="feedback" class="fw-bold mb-0"></p>
                            <button id="next-btn" class="btn btn-primary rounded-pill px-5 mt-2 d-none shadow" onclick="nextQuizQuestion()">
                                –°–ª–µ–¥–≤–∞—â ‚û°
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-flash" class="view-section">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-5">
                <div class="text-center mb-3">
                    <span class="text-muted small">–ù–∞—Ç–∏—Å–Ω–∏ –∫–∞—Ä—Ç–∞—Ç–∞, –∑–∞ –¥–∞ –≤–∏–¥–∏—à –æ—Ç–≥–æ–≤–æ—Ä–∞</span>
                </div>

                <div class="flip-card" onclick="flipCardLogic()">
                    <div class="flip-card-inner" id="flashcard-inner">
                        <div class="flip-card-front">
                            <small class="text-muted text-uppercase mb-3 fw-bold" id="fc-front-label">–í—ä–ø—Ä–æ—Å</small>
                            <h4 class="fw-bold" id="fc-front-text">...</h4>
                        </div>
                        <div class="flip-card-back">
                            <small class="text-white-50 text-uppercase mb-3 fw-bold">–û—Ç–≥–æ–≤–æ—Ä</small>
                            <h5 class="fw-bold" id="fc-back-text">...</h5>
                        </div>
                    </div>
                </div>

                <div id="fc-controls" class="mt-4 text-center" style="visibility: hidden;">
                    <p class="mb-2 fw-bold text-muted">–ó–Ω–∞–µ—à–µ –ª–∏ –≥–æ?</p>
                    <button class="btn btn-danger px-4 py-2 me-2 rounded-pill shadow-sm" onclick="rateFlashcard(false)">‚ùå –ù–µ</button>
                    <button class="btn btn-success px-4 py-2 rounded-pill shadow-sm" onclick="rateFlashcard(true)">‚úÖ –î–∞</button>
                </div>

            </div>
        </div>
    </div>

    <div id="view-list" class="view-section">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="card mb-3 shadow-sm border-0">
                    <div class="card-body text-center">
                        <div class="d-flex gap-2 flex-wrap justify-content-center">
                            <button class="btn btn-outline-primary btn-sm" onclick="downloadStats()">üíæ –ó–∞–ø–∞–∑–∏</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('file-input').click()">üìÇ –ó–∞—Ä–µ–¥–∏</button>
                            <button class="btn btn-outline-danger btn-sm" onclick="resetStats()">üóëÔ∏è –ù—É–ª–∏—Ä–∞–π</button>
                        </div>
                        <input type="file" id="file-input" style="display: none;" onchange="loadStats(this)">
                    </div>
                </div>
                <div class="list-group shadow-sm" id="list-container"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // --- DATA ---
    const rawData = [
        {id: 1, name: "–ú–í–† (–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ)", addr: "—É–ª. ‚Äû6-—Ç–∏ —Å–µ–ø—Ç–µ–º–≤—Ä–∏‚Äú ‚Ññ 29"},
        {id: 2, name: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞ –ø—Ä–∞–≤–æ—Å—ä–¥–∏–µ—Ç–æ", addr: "—É–ª. ‚Äû–°–ª–∞–≤—è–Ω—Å–∫–∞‚Äú ‚Ññ 1"},
        {id: 3, name: "–ú–†–†–ë (–†–µ–≥–∏–æ–Ω–∞–ª–Ω–æ —Ä–∞–∑–≤–∏—Ç–∏–µ)", addr: "—É–ª. ‚Äû–°–≤. –°–≤. –ö–∏—Ä–∏–ª –∏ –ú–µ—Ç–æ–¥–∏–π‚Äú ‚Ññ 17"},
        {id: 4, name: "–ú–¢–°–ü (–°–æ—Ü–∏–∞–ª–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞)", addr: "—É–ª. ‚Äû–¢—Ä–∏–∞–¥–∏—Ü–∞‚Äú ‚Ññ 2"},
        {id: 5, name: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–∏—Ç–µ", addr: "—É–ª. ‚Äû–ì. –°. –†–∞–∫–æ–≤—Å–∫–∏‚Äú ‚Ññ 102"},
        {id: 6, name: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞ –∏–∫–æ–Ω–æ–º–∏–∫–∞—Ç–∞", addr: "—É–ª. ‚Äû–°–ª–∞–≤—è–Ω—Å–∫–∞‚Äú ‚Ññ 8"},
        {id: 7, name: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞ –∑–µ–º–µ–¥–µ–ª–∏–µ—Ç–æ", addr: "–±—É–ª. ‚Äû–•—Ä–∏—Å—Ç–æ –ë–æ—Ç–µ–≤‚Äú ‚Ññ 55"},
        {id: 8, name: "–ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –Ω–∞ –µ–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞—Ç–∞", addr: "—É–ª. ‚Äû–¢—Ä–∏–∞–¥–∏—Ü–∞‚Äú ‚Ññ 8"},
        {id: 9, name: "–ö–ó–ö (–ó–∞—â–∏—Ç–∞ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è—Ç–∞)", addr: "–±—É–ª. –í–∏—Ç–æ—à–∞ ‚Ññ 18"},
        {id: 10, name: "–ö–§–ù (–§–∏–Ω–∞–Ω—Å–æ–≤ –Ω–∞–¥–∑–æ—Ä)", addr: "—É–ª. ‚Äû–ë—É–¥–∞–ø–µ—â–∞‚Äú ‚Ññ 16"},
        {id: 11, name: "–ò–ê ‚Äû–ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è‚Äú ‚Äì –¶–µ–Ω—Ç—ä—Ä", addr: "—É–ª. ‚Äû–ì–µ–Ω–µ—Ä–∞–ª –ì—É—Ä–∫–æ‚Äú ‚Ññ 5"},
        {id: 12, name: "–î–ê–ò –°–æ—Ñ–∏—è (–û–±–ª–∞—Å—Ç–µ–Ω –æ—Ç–¥–µ–ª)", addr: "—É–ª. ‚Äû–í–∏—Ç–∏–Ω—è‚Äú ‚Ññ 1"},
        {id: 13, name: "–ü–æ–∂–∞—Ä–Ω–∞ (–¶–µ–Ω—Ç—Ä–∞–ª–∞ –°–æ—Ñ–∏—è)", addr: "—É–ª. ‚Äû–ï–∫–∑–∞—Ä—Ö –ô–æ—Å–∏—Ñ‚Äú ‚Ññ 46"},
        {id: 14, name: "–°–î–í–† (–°—Ç–æ–ª–∏—á–Ω–∞ –ø–æ–ª–∏—Ü–∏—è)", addr: "—É–ª. ‚Äû–ï–∫–∑–∞—Ä—Ö –ê–Ω—Ç–∏–º I‚Äú ‚Ññ 5"},
        {id: 15, name: "–õ–µ—Ç–∏—â–µ –°–æ—Ñ–∏—è ‚Äì –¢–µ—Ä–º–∏–Ω–∞–ª 1", addr: "–±—É–ª. ‚Äû–•—Ä–∏—Å—Ç–æ—Ñ–æ—Ä –ö–æ–ª—É–º–±‚Äú ‚Ññ 1"},
        {id: 16, name: "08-–º–æ –†–£ ‚Äì –°–î–í–†", addr: "—É–ª. ‚Äû–ò–≤–∞–Ω –ê—Ä–∞–±–∞–¥–∂–∏—è—Ç–∞‚Äú ‚Ññ 141"},
        {id: 17, name: "03-—Ç–æ –†–£ ‚Äì –°–î–í–†", addr: "—É–ª. ‚Äû–ò–Ω–∂. –í–æ–π–≤–æ–¥–∞‚Äú ‚Ññ 2"},
        {id: 18, name: "02-—Ä–æ –†–£ ‚Äì –°–î–í–†", addr: "—É–ª. ‚Äû–ö–Ω—è–∑ –ë–æ—Ä–∏—Å I‚Äú ‚Ññ 215"},
        {id: 19, name: "–ñ–ü –≥–∞—Ä–∞ ‚Äû–ü–æ–¥—É—è–Ω–µ‚Äú", addr: "–±—É–ª. ‚Äû–ú–∞–¥—Ä–∏–¥‚Äú ‚Ññ 57"},
        {id: 20, name: "–ñ–ü –≥–∞—Ä–∞ ‚Äû–ó–∞—Ö–∞—Ä–Ω–∞ –§–∞–±—Ä–∏–∫–∞‚Äú", addr: "—É–ª. ‚Äû–ì—Ä—É—Ö –•—Ä–∏—Å—Ç–æ –°—Ç–æ—è–Ω–æ–≤‚Äú ‚Ññ 1"},
        {id: 21, name: "–¶–µ–Ω—Ç—Ä–∞–ª–Ω–∞ –ê–≤—Ç–æ–≥–∞—Ä–∞", addr: "–±—É–ª. ‚Äû–ö–Ω—è–≥–∏–Ω—è –ú–∞—Ä–∏—è –õ—É–∏–∑–∞‚Äú ‚Ññ 100"},
        {id: 22, name: "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤—Å–∫–∞ –±–æ–ª–Ω–∏—Ü–∞", addr: "—É–ª. ‚Äû–°–≤. –ì–µ–æ—Ä–≥–∏ –°–æ—Ñ–∏–π—Å–∫–∏‚Äú ‚Ññ 1"},
        {id: 23, name: "–ü–∏—Ä–æ–≥–æ–≤", addr: "–±—É–ª. ‚Äû–ì–µ–Ω–µ—Ä–∞–ª –ï–¥—É–∞—Ä–¥ –¢–æ—Ç–ª–µ–±–µ–Ω‚Äú ‚Ññ 21"},
        {id: 24, name: "–°–ø–µ—à–Ω–∞ –ø–æ–º–æ—â (–õ–∏–Ω–µ–π–∫–∏)", addr: "–±—É–ª. ‚Äû–í–∞—Å–∏–ª –õ–µ–≤—Å–∫–∏‚Äú ‚Ññ 129"},
        {id: 25, name: "–í–ú–ê (–í–æ–µ–Ω–Ω–∞ –±–æ–ª–Ω–∏—Ü–∞)", addr: "—É–ª. ‚Äû–°–≤. –ì–µ–æ—Ä–≥–∏ –°–æ—Ñ–∏–π—Å–∫–∏‚Äú ‚Ññ 3"},
        {id: 26, name: "–ù–∞—Ü–∏–æ–Ω–∞–ª–Ω–∞ –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏—á–Ω–∞ –±–æ–ª–Ω–∏—Ü–∞", addr: "—É–ª. ‚Äû–ö–æ–Ω—å–æ–≤–∏—Ü–∞‚Äú ‚Ññ 65"},
        {id: 27, name: "–¢–æ–∫—É–¥–∞ (–ê–¥–∂–∏–±–∞–¥–µ–º –°–∏—Ç–∏ –ö–ª–∏–Ω–∏–∫)", addr: "–±—É–ª. ‚Äû–ù–∏–∫–æ–ª–∞ –í–∞–ø—Ü–∞—Ä–æ–≤‚Äú ‚Ññ 51 ‚Äû–ë‚Äú"},
        {id: 28, name: "–ò–°–£–õ (–¶–∞—Ä–∏—Ü–∞ –ô–æ–∞–Ω–Ω–∞)", addr: "—É–ª. ‚Äû–ë—è–ª–æ –º–æ—Ä–µ‚Äú ‚Ññ 8"},
        {id: 29, name: "–û–∫—Ä—ä–∂–Ω–∞ –±–æ–ª–Ω–∏—Ü–∞ (–°–≤–µ—Ç–∞ –ê–Ω–Ω–∞)", addr: "—É–ª. ‚Äû–î–∏–º–∏—Ç—ä—Ä –ú–æ–ª–ª–æ–≤‚Äú ‚Ññ 1"},
        {id: 30, name: "–ú–∞–π—á–∏–Ω –¥–æ–º", addr: "—É–ª. ‚Äû–ó–¥—Ä–∞–≤–µ‚Äú ‚Ññ 2"},
        {id: 31, name: "–ü–°–ê–ì–ë ‚Äû–°–≤–µ—Ç–∞ –°–æ—Ñ–∏—è‚Äú (–¢–∏–Ω–∞ –ö–∏—Ä–∫–æ–≤–∞)", addr: "—É–ª. ‚Äû–ú–∏—Ö–∞–ª–∞–∫–∏ –¢–∞—à–µ–≤‚Äú ‚Ññ 2"},
        {id: 32, name: "–ë–æ–ª–Ω–∏—Ü–∞ ‚Äû–†–∞–π–Ω–∞ –∫–Ω—è–≥–∏–Ω—è‚Äú", addr: "—É–ª. ‚Äû–í–æ–π–≤–æ–¥–∏–Ω–∞ –º–æ–≥–∏–ª–∞‚Äú ‚Ññ 19"},
        {id: 33, name: "–®–µ–π–Ω–æ–≤–æ (–í—Ç–æ—Ä–∞ –°–ê–ì–ë–ê–õ)", addr: "—É–ª. ‚Äû–®–µ–π–Ω–æ–≤–æ‚Äú ‚Ññ 19"},
        {id: 34, name: "–ê—Ä–µ–Ω–∞ 8888 (–ê—Ä–º–µ–µ—Ü)", addr: "–±—É–ª. ‚Äû–ê—Å–µ–Ω –ô–æ—Ä–¥–∞–Ω–æ–≤‚Äú ‚Ññ 1"},
        {id: 35, name: "–°–ø–æ—Ä—Ç–µ–Ω —Ü–µ–Ω—Ç—ä—Ä –û—Ä–ª–∞–Ω–¥–æ–≤—Ü–∏", addr: "—É–ª. ‚Äû–ù–µ—à–æ –ë–æ–Ω—á–µ–≤‚Äú ‚Ññ 26"},
        {id: 36, name: "–ê—Å–∏–∫—Å –ê—Ä–µ–Ω–∞ (–§–µ—Å—Ç–∏–≤–∞–ª–Ω–∞)", addr: "—É–ª. ‚Äû–ú–∞–Ω–∞—Ñ—Å–∫–∞‚Äú ‚Ññ 35"},
        {id: 37, name: "–ó–∞–ª–∞ –£–Ω–∏–≤–µ—Ä—Å–∏–∞–¥–∞", addr: "–±—É–ª. ‚Äû–®–∏–ø—á–µ–Ω—Å–∫–∏ –ø—Ä–æ—Ö–æ–¥‚Äú ‚Ññ 2"},
        {id: 38, name: "–°–ø–æ—Ä—Ç–µ–Ω —Ü–µ–Ω—Ç—ä—Ä ‚Äû–ú–∞–∫—Å—Ñ–∏—Ç‚Äú", addr: "—É–ª. ‚Äû–ü–æ–ª–∫–æ–≤–Ω–∏–∫ –ë–æ—Ä–∏—Å –î—Ä–∞–Ω–≥–æ–≤‚Äú ‚Ññ 8"},
        {id: 39, name: "–ö–æ–º–ø–ª–µ–∫—Å ‚Äû–ê–∫–∞–¥–µ–º–∏–∫‚Äì4–∫–º.‚Äú", addr: "—É–ª. ‚Äû–∞–∫–∞–¥. –†–æ—Å—Ç–∏—Å–ª–∞–≤ –ö–∞–∏—à–µ–≤‚Äú ‚Ññ 125"},
        {id: 40, name: "–°—Ç–∞–¥–∏–æ–Ω ‚Äû–ì–µ—Ä–µ–Ω–∞‚Äú (–ì–µ–æ—Ä–≥–∏ –ê—Å–ø–∞—Ä—É—Ö–æ–≤)", addr: "—É–ª. ‚Äû–¢–æ–¥–æ—Ä–∏–Ω–∏ –∫—É–∫–ª–∏‚Äú ‚Ññ 47"},
        {id: 41, name: "–°—Ç–∞–¥–∏–æ–Ω ‚Äû–í–∞—Å–∏–ª –õ–µ–≤—Å–∫–∏‚Äú", addr: "–±—É–ª. ‚Äû–ï–≤–ª–æ–≥–∏ –∏ –•—Ä–∏—Å—Ç–æ –ì–µ–æ—Ä–≥–∏–µ–≤–∏‚Äú ‚Ññ 38"},
        {id: 42, name: "–°—Ç–∞–¥–∏–æ–Ω ‚Äû–ë—ä–ª–≥–∞—Ä—Å–∫–∞ –∞—Ä–º–∏—è‚Äú", addr: "–±—É–ª. ‚Äû–î—Ä–∞–≥–∞–Ω –¶–∞–Ω–∫–æ–≤‚Äú ‚Ññ 3"},
        {id: 43, name: "–°—Ç–∞–¥–∏–æ–Ω ‚Äû–°–ª–∞–≤–∏—è‚Äú", addr: "—É–ª. ‚Äû–ö–æ–ª–æ–º–∞–Ω‚Äú 1"},
        {id: 44, name: "–°—Ç–∞–¥–∏–æ–Ω ‚Äû–†–∞–∫–æ–≤—Å–∫–∏‚Äú", addr: "—É–ª. ‚Äû–ë–∞–ª—à–∞‚Äú ‚Ññ 18"},
        {id: 45, name: "–í–°–£ ‚Äû–õ—é–±–µ–Ω –ö–∞—Ä–∞–≤–µ–ª–æ–≤‚Äú", addr: "—É–ª. ‚Äû–°—É—Ö–æ–¥–æ–ª—Å–∫–∞‚Äú ‚Ññ 175"},
        {id: 46, name: "–ú—É–∑–∏–∫–∞–ª–Ω–∞ –∞–∫–∞–¥–µ–º–∏—è (–ü–∞–Ω—á–æ –í–ª–∞–¥–∏–≥–µ—Ä–æ–≤)", addr: "–±—É–ª. ‚Äû–ï–≤–ª–æ–≥–∏ –∏ –•—Ä–∏—Å—Ç–æ –ì–µ–æ—Ä–≥–∏–µ–≤–∏‚Äú ‚Ññ 94"},
        {id: 47, name: "–í–æ–µ–Ω–Ω–∞ –∞–∫–∞–¥–µ–º–∏—è", addr: "–±—É–ª. ‚Äû–ï–≤–ª–æ–≥–∏ –∏ –•—Ä–∏—Å—Ç–æ –ì–µ–æ—Ä–≥–∏–µ–≤–∏‚Äú ‚Ññ 82"},
        {id: 48, name: "–õ–µ—Å–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", addr: "–±—É–ª. ‚Äû–°–≤. –ö–ª–∏–º–µ–Ω—Ç –û—Ö—Ä–∏–¥—Å–∫–∏‚Äú ‚Ññ 10"},
        {id: 49, name: "–£–ê–°–ì (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—Å—Ç–≤–æ)", addr: "–±—É–ª. ‚Äû–•—Ä–∏—Å—Ç–æ –°–º–∏—Ä–Ω–µ–Ω—Å–∫–∏‚Äú ‚Ññ 1"},
        {id: 50, name: "–í–¢–£ ‚Äû–¢–æ–¥–æ—Ä –ö–∞–±–ª–µ—à–∫–æ–≤‚Äú", addr: "—É–ª. ‚Äû–ì–µ–æ –ú–∏–ª–µ–≤‚Äú ‚Ññ 158"},
        {id: 51, name: "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", addr: "–±—É–ª. ‚Äû–ê–∫–∞–¥–µ–º–∏–∫ –ò–≤–∞–Ω –ï–≤—Å—Ç–∞—Ç–∏–µ–≤ –ì–µ—à–æ–≤‚Äú ‚Ññ 15"},
        {id: 52, name: "–°–æ—Ñ–∏–π—Å–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç (–†–µ–∫—Ç–æ—Ä–∞—Ç)", addr: "–±—É–ª. ‚Äû–¶–∞—Ä –û—Å–≤–æ–±–æ–¥–∏—Ç–µ–ª‚Äú ‚Ññ 15"},
        {id: 53, name: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç (–¢–£)", addr: "–±—É–ª. ‚Äû–ö–ª–∏–º–µ–Ω—Ç –û—Ö—Ä–∏–¥—Å–∫–∏‚Äú ‚Ññ 8"},
        {id: 54, name: "–ê–∫–∞–¥–µ–º–∏—è –Ω–∞ –ú–í–†", addr: "–±—É–ª. ‚Äû–ê–ª–µ–∫—Å–∞–Ω–¥—ä—Ä –ú–∞–ª–∏–Ω–æ–≤‚Äú ‚Ññ 91"},
        {id: 55, name: "–•–∏–º–∏–∫–æ-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ–Ω (–•–¢–ú–£)", addr: "–±—É–ª. ‚Äû–°–≤. –ö–ª–∏–º–µ–Ω—Ç –û—Ö—Ä–∏–¥—Å–∫–∏‚Äú ‚Ññ 8"},
        {id: 56, name: "–•–æ—Ç–µ–ª ‚Äû–†–æ—Å–ª–∏–Ω –°–µ–Ω—Ç—Ä—ä–ª –ü–∞—Ä–∫‚Äú", addr: "–±—É–ª. ‚Äû–í–∏—Ç–æ—à–∞‚Äú ‚Ññ 106"},
        {id: 57, name: "–ì—Ä–∞–Ω–¥ —Ö–æ—Ç–µ–ª –°–æ—Ñ–∏—è", addr: "—É–ª. ‚Äû–≥–µ–Ω. –ô–æ—Å–∏—Ñ –í. –ì—É—Ä–∫–æ‚Äú ‚Ññ 1"},
        {id: 58, name: "–•–æ—Ç–µ–ª ‚Äû–•–µ–º—É—Å‚Äú", addr: "–±—É–ª. ‚Äû–ß–µ—Ä–Ω–∏ –≤—Ä—ä—Ö‚Äú ‚Ññ 25"},
        {id: 59, name: "–•–æ—Ç–µ–ª ‚Äû–ñ–∞—Å–º–∏–Ω‚Äú", addr: "–±—É–ª. ‚Äû–°–∏–º–µ–æ–Ω–æ–≤—Å–∫–æ —à–æ—Å–µ‚Äú ‚Ññ 252"},
        {id: 60, name: "–•–æ—Ç–µ–ª ‚Äû–ë—Ä–æ–¥‚Äú", addr: "–±—É–ª. ‚Äû–°–∏–º–µ–æ–Ω–æ–≤—Å–∫–æ —à–æ—Å–µ‚Äú ‚Ññ 66"},
        {id: 61, name: "–•–æ—Ç–µ–ª ‚Äû–ú–∞—Ä–∏–Ω–µ–ª–∞‚Äú", addr: "–±—É–ª. ‚Äû–î–∂–µ–π–º—Å –ë–∞—É—á—ä—Ä‚Äú ‚Ññ 100"},
        {id: 62, name: "–•–æ—Ç–µ–ª ‚Äû–ö—Ä–∏—Å—Ç–∞–ª –ø–∞–ª–∞—Å‚Äú", addr: "—É–ª. ‚Äû–®–∏–ø–∫–∞‚Äú ‚Ññ 14"},
        {id: 63, name: "–•–æ—Ç–µ–ª ‚Äû–ú–µ–≥ ‚Äì –õ–æ–∑–µ–Ω–µ—Ü‚Äú", addr: "—É–ª. ‚Äû–ö—Ä—É–º –ü–æ–ø–æ–≤‚Äú ‚Ññ 84"},
        {id: 64, name: "–•–æ—Ç–µ–ª ‚Äû–ò–Ω—Ç–µ—Ä–∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞–ª‚Äú", addr: "–ø–ª. ‚Äû–ù–∞—Ä–æ–¥–Ω–æ —Å—ä–±—Ä–∞–Ω–∏–µ‚Äú ‚Ññ 4"},
        {id: 65, name: "–•–æ—Ç–µ–ª ‚Äû–¶–µ–Ω—Ç—Ä–∞–ª‚Äú", addr: "–±—É–ª. ‚Äû–•—Ä–∏—Å—Ç–æ –ë–æ—Ç–µ–≤‚Äú ‚Ññ 52"},
        {id: 66, name: "–•–æ—Ç–µ–ª ‚Äû–•–ò–õ‚Äú", addr: "–±—É–ª. ‚Äû–î–∂–µ–π–º—Å –ë–∞—É—á—ä—Ä‚Äú ‚Ññ 76 ‚Äû–ë‚Äú"}
    ];

    // --- STATE ---
    let locations = [];
    let currentQuestion = null;
    let streak = 0;
    let totalCorrect = 0;
    let isFlipped = false; // For flashcards

    // --- INIT ---
    function init() {
        const saved = localStorage.getItem('volt_locations_v4');
        if (saved) {
            locations = JSON.parse(saved);
        } else {
            locations = rawData.map(l => ({...l, correct: 0, wrong: 0, lastSeen: 0}));
        }
        
        // Start with quiz
        nextQuizQuestion();
    }

    // --- CORE LOGIC ---
    function getWeightedRandom() {
        const now = Date.now();
        let candidates = [];
        
        locations.forEach(loc => {
            let weight = 1;
            weight += (loc.wrong * 8); // Heavy weight on errors
            if (loc.correct === 0 && loc.wrong === 0) weight += 30; // Boost new
            
            // Spaced repetition boost
            const timeSince = now - loc.lastSeen;
            if (loc.lastSeen > 0) weight += Math.floor(timeSince / 120000); 

            // Reduce if mastered
            if (loc.correct > (loc.wrong + 3) && timeSince < 600000) weight = 1; 
            
            for(let i=0; i < weight; i++) candidates.push(loc);
        });
        
        return candidates[Math.floor(Math.random() * candidates.length)];
    }

    function determineDirection() {
        const modeSelect = document.getElementById('gameMode').value;
        if (modeSelect === 'mixed') {
            return Math.random() < 0.5 ? 'standard' : 'reverse';
        }
        return modeSelect;
    }

    // --- QUIZ FUNCTIONS ---
    function nextQuizQuestion() {
        document.getElementById('feedback').innerText = '';
        document.getElementById('next-btn').classList.add('d-none');
        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';

        currentQuestion = getWeightedRandom();
        const dir = determineDirection();

        // UI Setup
        const qLabel = document.getElementById('q-label');
        const qText = document.getElementById('question-text');

        if (dir === 'standard') {
            qLabel.innerText = "–ö—ä–¥–µ —Å–µ –Ω–∞–º–∏—Ä–∞:";
            qText.innerHTML = `<span class="highlight-name text-primary">${currentQuestion.name}</span>`;
            qText.classList.remove('fs-5');
        } else {
            qLabel.innerText = "–ö–∞–∫–≤–æ –∏–º–∞ –Ω–∞ –∞–¥—Ä–µ—Å:";
            qText.innerHTML = `<span class="highlight-addr text-danger">${currentQuestion.addr}</span>`;
            qText.classList.add('fs-5');
        }

        // Distractors
        let options = [currentQuestion];
        while (options.length < 4) {
            let r = locations[Math.floor(Math.random() * locations.length)];
            // Prevent duplicate addresses (e.g. TU and HTMU)
            if (!options.includes(r) && r.addr !== currentQuestion.addr) {
                options.push(r);
            }
        }
        options.sort(() => Math.random() - 0.5);

        // Buttons
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-outline-secondary btn-lg btn-option py-3 shadow-sm mb-2';
            btn.innerText = (dir === 'standard') ? opt.addr : opt.name;
            btn.onclick = () => checkQuizAnswer(opt, btn, dir);
            optsContainer.appendChild(btn);
        });
    }

    function checkQuizAnswer(selected, btnElement, dir) {
        if (!document.getElementById('next-btn').classList.contains('d-none')) return;

        const isCorrect = selected.id === currentQuestion.id;
        const feedback = document.getElementById('feedback');
        const realObj = locations.find(l => l.id === currentQuestion.id);
        realObj.lastSeen = Date.now();

        // Highlight Correct
        const allBtns = document.querySelectorAll('.btn-option');
        allBtns.forEach(b => {
            const correctText = (dir === 'standard') ? currentQuestion.addr : currentQuestion.name;
            if (b.innerText === correctText) {
                b.classList.remove('btn-outline-secondary');
                b.classList.add('btn-success');
            }
        });

        if (isCorrect) {
            feedback.innerText = "üéâ –ë—Ä–∞–≤–æ!";
            feedback.className = "text-success fw-bold";
            realObj.correct++;
            streak++;
            totalCorrect++;
        } else {
            btnElement.classList.remove('btn-outline-secondary');
            btnElement.classList.add('btn-danger');
            feedback.innerText = "‚ùå –ì—Ä–µ—à–∫–∞!";
            feedback.className = "text-danger fw-bold";
            realObj.wrong++;
            streak = 0;
        }

        updateStatsUI();
        saveProgress();
        document.getElementById('next-btn').classList.remove('d-none');
    }

    // --- FLASHCARD FUNCTIONS ---
    function nextFlashcard() {
        currentQuestion = getWeightedRandom();
        isFlipped = false;
        
        const cardInner = document.getElementById('flashcard-inner');
        const dir = determineDirection();
        
        // Reset Visuals
        document.querySelector('.flip-card').classList.remove('flipped');
        document.getElementById('fc-controls').style.visibility = 'hidden';

        // Set Text
        if (dir === 'standard') {
            document.getElementById('fc-front-label').innerText = "–û–±–µ–∫—Ç";
            document.getElementById('fc-front-text').innerText = currentQuestion.name;
            document.getElementById('fc-back-text').innerText = currentQuestion.addr;
        } else {
            document.getElementById('fc-front-label').innerText = "–ê–¥—Ä–µ—Å";
            document.getElementById('fc-front-text').innerText = currentQuestion.addr;
            document.getElementById('fc-back-text').innerText = currentQuestion.name;
        }
    }

    function flipCardLogic() {
        if (!isFlipped) {
            document.querySelector('.flip-card').classList.add('flipped');
            document.getElementById('fc-controls').style.visibility = 'visible';
            isFlipped = true;
        }
    }

    function rateFlashcard(known) {
        const realObj = locations.find(l => l.id === currentQuestion.id);
        realObj.lastSeen = Date.now();
        
        if (known) {
            realObj.correct++;
            streak++;
            totalCorrect++;
        } else {
            realObj.wrong++;
            streak = 0;
        }
        
        updateStatsUI();
        saveProgress();
        
        // Small delay before next card for better UX
        setTimeout(() => {
            nextFlashcard();
        }, 300);
    }

    // --- SHARED UI ---
    function updateStatsUI() {
        document.getElementById('streak').innerText = streak;
        document.getElementById('total-correct').innerText = totalCorrect;
    }

    function refreshCurrentView() {
        if (document.getElementById('view-quiz').classList.contains('active')) nextQuizQuestion();
        if (document.getElementById('view-flash').classList.contains('active')) nextFlashcard();
    }

    function switchTab(tab) {
        // Nav Styles
        document.querySelectorAll('#mainNav .nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');

        // View Visibility
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        
        if (tab === 'quiz') {
            document.getElementById('view-quiz').classList.add('active');
            nextQuizQuestion();
        } else if (tab === 'flash') {
            document.getElementById('view-flash').classList.add('active');
            nextFlashcard();
        } else {
            document.getElementById('view-list').classList.add('active');
            renderList();
        }
    }

    // --- LIST & SAVE ---
    function renderList() {
        const container = document.getElementById('list-container');
        container.innerHTML = '';
        const sorted = [...locations].sort((a, b) => b.wrong - a.wrong);

        sorted.forEach(loc => {
            const div = document.createElement('div');
            div.className = 'list-group-item d-flex justify-content-between align-items-center p-2';
            
            let color = 'bg-secondary';
            if (loc.wrong > loc.correct) color = 'bg-danger';
            if (loc.correct > loc.wrong + 2) color = 'bg-success';

            div.innerHTML = `
                <div class="me-2 overflow-hidden">
                    <div class="fw-bold text-truncate" style="font-size:0.9rem">${loc.name}</div>
                    <div class="address-sub text-truncate">${loc.addr}</div>
                </div>
                <div class="badge ${color}">
                    ‚úì${loc.correct} / ‚úó${loc.wrong}
                </div>
            `;
            container.appendChild(div);
        });
    }

    function saveProgress() {
        localStorage.setItem('volt_locations_v4', JSON.stringify(locations));
    }

    function downloadStats() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(locations));
        const anchor = document.createElement('a');
        anchor.href = dataStr;
        anchor.download = `volt_stats.json`;
        anchor.click();
    }

    function loadStats(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                locations = JSON.parse(e.target.result);
                saveProgress();
                alert("–£—Å–ø–µ—à–Ω–æ!");
                location.reload();
            } catch (err) { alert("–ì—Ä–µ—à–∫–∞!"); }
        };
        reader.readAsText(file);
    }

    function resetStats() {
        if(confirm("–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ?")) {
            localStorage.removeItem('volt_locations_v4');
            location.reload();
        }
    }

    init();
</script>
</body>
</html>
